{% extends "global/Base.html" %}
{% load staticfiles otree_tags %}

{% block content %}

<button class="btn btn-primary pull-right" style="display: none;"></button>

<script type="text/javascript">
  $(function() {
    var startTime = {{global_time_start}},
        endTime = {{global_time_stop}},
        threshold = +{{threshold}},
        redirection = '{{speedsters_redirection}}'
        isSpeedster = (endTime - startTime) < threshold,
        locale = extractLang('{{language_code}}'),
        fragment,
        url;

    // Return fragment of locale from given locale.
    function extractLang(lang) {
      return lang.length > 2 ? lang.slice(0, 2) : lang;
    }

    // Build redirection link, and form payload.
    if (locale === 'ko') {
      url = redirection + '&' + '{{label}}';
    } else {
      fragment = '{{label}}'.split('|').filter(function (f) {
        if (f.indexOf('ac') > -1 || f.indexOf('sc') > -1 || f.indexOf('sn') > -1 || f.indexOf('z') > -1) {
          return f;
        }
      }).join('&');

      url = redirection + '&' + fragment + '&lang=' + locale;
    }

    if (isSpeedster) {
      console.log('Participant is a speedster... redirecting.');
      window.location.href = url;
    } else {
      console.log('Redirecting to Earnings page.')
      $('form').submit();
    }
  });
</script>

{% endblock %}
